<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raspberry Pi Camera</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; }
        .container { position: relative; width: 100%; max-width: 800px; margin: auto; }
        #videoFeed { width: 100%; }
        .button { position: absolute; bottom: 30px; right: 30px; width: 50px; height: 50px; border-radius: 50%; background-color: green; color: white; border: none; cursor: pointer; font-size: 20px; }
        .button.recording { background-color: red; }
        .screenshot-button { position: absolute; bottom: 100px; right: 30px; width: 50px; height: 50px; border-radius: 50%; background-color: blue; color: white; border: none; cursor: pointer; font-size: 20px; }
        .move-button { margin-top: 20px; padding: 10px; cursor: pointer; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Live Video Feed</h1>
        <img id="videoFeed" src="{{ url_for('video_feed') }}" alt="Video Feed"/>
        <button class="button" id="recordBtn" onclick="toggleRecording()">Start Recording</button>
        <button class="screenshot-button" onclick="captureScreenshot()">Capture Screenshot</button>
        <button class="move-button" onclick="sendCommand('move_up')">Move Up</button>
        <button class="move-button" onclick="sendCommand('move_down')">Move Down</button>
        <button class="move-button" onclick="sendCommand('move_left')">Move Left</button>
        <button class="move-button" onclick="sendCommand('move_right')">Move Right</button>
    </div>

    <script>
        let isRecording = false;

        // 切换录制状态
        function toggleRecording() {
            if (isRecording) {
                fetch('/stop_recording').then(response => response.blob())
                    .then(blob => {
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.style.display = 'none';
                        a.href = url;
                        a.download = 'video.avi';
                        document.body.appendChild(a);
                        a.click();
                        window.URL.revokeObjectURL(url);
                    });
                document.getElementById('recordBtn').innerText = 'Start Recording';
                document.getElementById('recordBtn').classList.remove('recording');
            } else {
                fetch('/start_recording');
                document.getElementById('recordBtn').innerText = 'Stop Recording';
                document.getElementById('recordBtn').classList.add('recording');
            }
            isRecording = !isRecording;
        }

        // 截图并保存到浏览器
        function captureScreenshot() {
            fetch('/take_picture').then(response => response.blob())
                .then(blob => {
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.style.display = 'none';
                    a.href = url;
                    a.download = 'screenshot.jpg'; // 文件名为screenshot.jpg
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                });
        }

        // 发送方向控制命令
        function sendCommand(command) {
            fetch('/send_command', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ command: command })
            });
        }
    </script>
</body>
</html>
